{% extends "base.html" %}
{% load static %}
{% load tz %}
{% load ai_filters %}

{% block title %}Standup Reports - PulzeBot{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/standup_report.css' %}">
{% endblock %}

{% block head_js %}
<!-- Alpine.js Standup Report Component (load before Alpine.js core) -->
<script src="{% static 'js/standup_report.js' %}"></script>
{% endblock %}

{% block content %}
{% csrf_token %}
<div id="standup-report-root" class="min-vh-100 bg-light" x-data="standupReportApp()" data-selected-date="{{ selected_date|date:'F j, Y' }}">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container py-4 text-center">
            <h1 class="h4 mb-0">Team Standup Reports</h1>
            <small class="text-white-50">Daily progress & team insights</small>
        </div>
    </header>

    <!-- Main Content -->
    <div class="container py-4">
        <!-- Quick Stats -->
        <div class="row g-4 mb-4">
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="stat-icon stat-icon-primary me-3">
                            <i class="fas fa-users text-primary"></i>
                        </div>
                        <div>
                            <div class="small text-muted">Team Members</div>
                            <div class="h5 mb-0">{{ team_members_count }}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="stat-icon stat-icon-success me-3">
                            <i class="fas fa-check text-success"></i>
                        </div>
                        <div>
                            <div class="small text-muted">Submitted Today</div>
                            <div class="h5 mb-0">{{ submitted_today }}/{{ team_members_count }}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="stat-icon stat-icon-warning me-3">
                            <i class="fas fa-exclamation-triangle text-warning"></i>
                        </div>
                        <div>
                            <div class="small text-muted">Active Blockers</div>
                            <div class="h5 mb-0">{{ active_blockers }}</div>
                        </div>
                    </div>
                </div>
            </div>
            <div class="col-12 col-md-6 col-lg-3">
                <div class="card h-100">
                    <div class="card-body d-flex align-items-center">
                        <div class="stat-icon stat-icon-purple me-3">
                            <i class="fas fa-smile text-purple"></i>
                        </div>
                        <div>
                            <div class="small text-muted">Team Health</div>
                            <div class="h5 mb-0">{{ avg_mood_score }}/10</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Period Comparison -->
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-calendar me-2"></i>
                            Period Comparison
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="table-responsive">
                            <table class="table table-sm">
                                <thead>
                                    <tr>
                                        <th>Metric</th>
                                        <th>7 Days</th>
                                        <th>30 Days</th>
                                        <th>Change</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td>Participation Rate</td>
                                        <td>{{ metrics_7d.participation.rate|default:"0"|floatformat:1 }}%</td>
                                        <td>{{ metrics_30d.participation.rate|default:"0"|floatformat:1 }}%</td>
                                        <td>
                                            {% if metrics_7d.participation.rate > metrics_30d.participation.rate %}
                                                <span class="text-success">↑ Improving</span>
                                            {% elif metrics_7d.participation.rate < metrics_30d.participation.rate %}
                                                <span class="text-danger">↓ Declining</span>
                                            {% else %}
                                                <span class="text-secondary">→ Stable</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Team Sentiment</td>
                                        <td>{{ metrics_7d.sentiment.score|default:"0"|floatformat:1 }}</td>
                                        <td>{{ metrics_30d.sentiment.score|default:"0"|floatformat:1 }}</td>
                                        <td>
                                            {% if metrics_7d.sentiment.score > metrics_30d.sentiment.score %}
                                                <span class="text-success">↑ Improving</span>
                                            {% elif metrics_7d.sentiment.score < metrics_30d.sentiment.score %}
                                                <span class="text-danger">↓ Declining</span>
                                            {% else %}
                                                <span class="text-secondary">→ Stable</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Blocker Resolution</td>
                                        <td>{{ metrics_7d.blockers.resolution_rate|default:"0"|floatformat:1 }}%</td>
                                        <td>{{ metrics_30d.blockers.resolution_rate|default:"0"|floatformat:1 }}%</td>
                                        <td>
                                            {% if metrics_7d.blockers.resolution_rate > metrics_30d.blockers.resolution_rate %}
                                                <span class="text-success">↑ Improving</span>
                                            {% elif metrics_7d.blockers.resolution_rate < metrics_30d.blockers.resolution_rate %}
                                                <span class="text-danger">↓ Declining</span>
                                            {% else %}
                                                <span class="text-secondary">→ Stable</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                    <tr>
                                        <td>Work Item Progress</td>
                                        <td>{{ metrics_7d.work_items.completion_rate|default:"0"|floatformat:1 }}%</td>
                                        <td>{{ metrics_30d.work_items.completion_rate|default:"0"|floatformat:1 }}%</td>
                                        <td>
                                            {% if metrics_7d.work_items.completion_rate > metrics_30d.work_items.completion_rate %}
                                                <span class="text-success">↑ Improving</span>
                                            {% elif metrics_7d.work_items.completion_rate < metrics_30d.work_items.completion_rate %}
                                                <span class="text-danger">↓ Declining</span>
                                            {% else %}
                                                <span class="text-secondary">→ Stable</span>
                                            {% endif %}
                                        </td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Analytics -->
        {% if standup_reports %}
        <div class="row g-4 mb-4">
            <!-- Team Mood Trends -->
            <div class="col-12 col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h3 class="h6 mb-3">Team Mood Trends (Past Week)</h3>
                        <canvas id="moodChart" width="400" height="200"
                                data-chart='{{ trend_chart_json|safe }}'></canvas>
                    </div>
                </div>
            </div>

            <!-- Blocker Analysis -->
            <div class="col-12 col-lg-6">
                <div class="card shadow-sm">
                    <div class="card-body">
                        <h3 class="h6 mb-3">Blocker Categories</h3>
                        <canvas id="blockerChart" width="400" height="200"
                                data-chart='{{ blocker_chart_json|safe }}'></canvas>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- AI-Powered Team Insights Section -->
        {% if gemini_summaries %}
        <div class="row mb-4">
            <div class="col-12">
                <div class="card shadow-sm">
                    <div class="card-header">
                        <h5 class="mb-0">
                            <i class="fas fa-robot me-2 text-primary"></i>
                            AI-Powered Team Insights
                        </h5>
                        <small class="text-muted">Comprehensive standup replacement insights generated by Gemini AI Model</small>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            {% for summary in gemini_summaries %}
                            <div class="col-12 mb-4">
                                <div class="card h-100 border-start border-4 border-primary">
                                    <div class="card-header bg-light">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <h6 class="mb-0">
                                                <i class="fas fa-user me-2"></i>
                                                {{ summary.user }}
                                            </h6>
                                            <div class="d-flex align-items-center">
                                                <small class="text-muted">{{ summary.date|date:"M j" }}</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-body">
                                        <!-- AI Summary -->
                                        <div class="mb-3">
                                            <div class="ai-analysis-header mb-3">
                                                <div class="d-flex align-items-center justify-content-between">
                                                    <h6 class="text-primary mb-0 d-flex align-items-center">
                                                        <i class="fas fa-brain me-2"></i>Strategic AI Analysis
                                                    </h6>
                                                    <div class="badge bg-primary-subtle text-primary">
                                                        <i class="fas fa-robot me-1"></i>AI Generated
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {% if summary.summary %}
                                                <div class="ai-analysis-content">
                                                    <div class="ai-content-formatted">
                                                        {{ summary.summary|format_markdown|safe }}
                                                    </div>
                                                </div>
                                            {% else %}
                                                <div class="ai-analysis-empty">
                                                    <div class="text-center py-4">
                                                        <i class="fas fa-lightbulb text-muted mb-2" style="font-size: 1.5rem;"></i>
                                                        <p class="text-muted mb-0">No AI analysis available for this submission</p>
                                                        <small class="text-muted">Strategic insights will appear here when available</small>
                                                    </div>
                                                </div>
                                            {% endif %}
                                        </div>

                                        <!-- Individual Updates Section -->
                                        {% if summary.individual_updates %}
                                        <div class="mb-3">
                                            <h6 class="text-info mb-2">
                                                <i class="fas fa-tasks me-1"></i>Individual Updates
                                            </h6>
                                            <div class="small">
                                                <div class="mb-2 p-2 bg-light rounded">
                                                    <strong>Yesterday:</strong> 
                                                    <span class="text-muted">{{ summary.individual_updates.yesterday_work|truncatewords:15 }}</span>
                                                </div>
                                                <div class="mb-2 p-2 bg-light rounded">
                                                    <strong>Today:</strong> 
                                                    <span class="text-muted">{{ summary.individual_updates.today_plan|truncatewords:15 }}</span>
                                                </div>
                                                <div class="mb-2 p-2 bg-light rounded">
                                                    <strong>Blockers:</strong> 
                                                    <span class="text-muted">{{ summary.individual_updates.blockers|truncatewords:10 }}</span>
                                                </div>
                                            </div>
                                        </div>
                                        {% endif %}

                                        <!-- Sentiment Score -->
                                        {% if summary.sentiment_score %}
                                        <div class="mt-3 pt-2 border-top">
                                            <div class="d-flex justify-content-between align-items-center">
                                            <small class="text-muted">
                                                    <i class="fas fa-heart me-1"></i>Sentiment Score
                                            </small>
                                                <span class="badge bg-{% if summary.sentiment_score >= 0.7 %}success{% elif summary.sentiment_score >= 0.4 %}warning{% else %}danger{% endif %}">
                                                    {{ summary.sentiment_score|floatformat:2 }}
                                                </span>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <!-- Strategic Team Insights Summary removed - was static placeholder content -->

        <!-- Combined Team Dashboard Container -->
        <div class="card shadow-sm mb-4">
            <!-- Team Dashboard Header with Toggle Controls -->
            <div class="card-header">
                <div class="d-flex justify-content-between align-items-center flex-wrap gap-2">
                    <h3 class="h6 mb-0">Team Dashboard</h3>
                    <div class="btn-group" role="group" aria-label="Main Section">
                        <input type="radio" class="btn-check" name="mainSection" id="reportsToggle" value="reports" checked>
                        <label class="btn btn-outline-primary" for="reportsToggle">Reports</label>
                        
                        <input type="radio" class="btn-check" name="mainSection" id="blockersToggle" value="blockers">
                        <label class="btn btn-outline-primary" for="blockersToggle">Blockers</label>
                    </div>
                </div>
            </div>



            <!-- Main Content Section -->
            <div id="mainTabContent" class="tab-content">
                <!-- Reports Section -->
                <div id="reportsSection" class="tab-pane fade show active">
                    <!-- Reports Sub-tabs -->
                    <div class="card-body border-bottom">
                    <ul class="nav nav-tabs" id="reportsTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="daily-reports-tab" data-bs-toggle="tab" data-bs-target="#daily-reports" type="button" role="tab" aria-controls="daily-reports" aria-selected="true">
                                <i class="fas fa-calendar-day me-2"></i>Daily
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="weekly-reports-tab" data-bs-toggle="tab" data-bs-target="#weekly-reports" type="button" role="tab" aria-controls="weekly-reports" aria-selected="false">
                                <i class="fas fa-calendar-week me-2"></i>Weekly
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="all-time-reports-tab" data-bs-toggle="tab" data-bs-target="#all-time-reports" type="button" role="tab" aria-controls="all-time-reports" aria-selected="false">
                                <i class="fas fa-calendar-alt me-2"></i>All Time
                            </button>
                        </li>
                    </ul>
                </div>

                <!-- Reports Tab Content -->
                <div id="reportsTabContent" class="tab-content">
                <!-- Daily Reports Tab -->
                <div class="tab-pane fade show active" id="daily-reports" role="tabpanel" aria-labelledby="daily-reports-tab">
                    <div class="card-scrollable">
                        <div class="tab-content-header">
                            <div class="d-flex align-items-center justify-content-between">
                                <h4 class="h6 mb-0 text-primary" id="reportTitle">
                                    <i class="fas fa-calendar-day me-2"></i>Daily Standup Reports
                                </h4>
                            <small class="text-muted" id="reportDateRange">{{ selected_date|date:"F j, Y" }}</small>
                            </div>
                        </div>
                        <div class="list-group list-group-flush" id="standupReportsContainer">
                            <div id="dailyReportsContent" class="report-content">
                                {% for standup in standup_reports %}
                                <div class="list-group-item p-4" x-data="{ isOpen: false }">
                                    <!-- Team Member Header -->
                                    <div @click="isOpen = !isOpen" class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center gap-3">
                                            <div class="avatar-circle text-white">
                                                <span class="fw-semibold">{{ standup.user|first|upper }}</span>
                                            </div>
                                            <div>
                                                <h4 class="h6 mb-1">{{ standup.user }}</h4>
                                                <div class="d-flex align-items-center gap-3 small text-muted">
                                                    <span class="d-inline-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-primary" fill="currentColor" viewBox="0 0 24 24">
                                                            <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                                        </svg>
                                                        BERT: {{ standup.bert_sentiment_display }}
                                                    </span>
                                                    {% if standup.has_blockers %}
                                                    <span class="badge bg-danger-subtle text-danger">
                                                        Blocked
                                                    </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end" style="min-width: 120px;">
                                            <div class="small text-muted">{% timezone "Asia/Singapore" %}{{ standup.timestamp|date:"M j, g:i A" }}{% endtimezone %}</div>
                                        </div>
                                    </div>

                                    <!-- Expandable Content -->
                                    <div x-show="isOpen" class="mt-3">
                                        <div class="row g-3">
                                            <!-- Yesterday's Work -->
                                            <div class="col-12 col-md-6">
                                                <div class="bg-light rounded p-3 h-100">
                                                    <h5 class="mb-2 d-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                        </svg>
                                                        Yesterday's Accomplishments
                                                    </h5>
                                                    <p class="mb-0">{{ standup.yesterday|default:"No updates provided" }}</p>
                                                </div>
                                            </div>

                                            <!-- Today's Plans -->
                                            <div class="col-12 col-md-6">
                                                <div class="rounded p-3 h-100 content-section-blue">
                                                    <h5 class="mb-2 d-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                        </svg>
                                                        Today's Goals
                                                    </h5>
                                                    <p class="mb-0">{{ standup.today|default:"No goals specified" }}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Blockers & Concerns -->
                                        {% if standup.blockers %}
                                        <div class="mt-3 p-3 rounded border-start border-4 blocker-section">
                                            <h5 class="mb-2 d-flex align-items-center">
                                                <svg width="16" height="16" class="me-2 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                                </svg>
                                                Blockers & Concerns
                                            </h5>
                                            <p class="mb-0">{{ standup.blockers }}</p>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% empty %}
                                <div class="empty-state">
                                    <svg class="empty-state-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <h3 class="h6 mt-2">No standup reports</h3>
                                    <p class="text-muted">No standup reports have been submitted for today.</p>
                                    <button @click="window.location.href='{% url 'dashboard:dashboard' %}'" class="btn btn-primary btn-sm">
                                        <i class="fas fa-plus me-2"></i>Submit Standup
                                    </button>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Weekly Reports Tab -->
                <div class="tab-pane fade" id="weekly-reports" role="tabpanel" aria-labelledby="weekly-reports-tab">
                    <div class="card-scrollable">
                        <div class="tab-content-header">
                            <div class="d-flex align-items-center justify-content-between">
                                <h4 class="h6 mb-0 text-primary">
                                    <i class="fas fa-calendar-week me-2"></i>Weekly Standup Reports
                                </h4>
                            <small class="text-muted">Past 7 Days</small>
                            </div>
                        </div>
                        <div class="list-group list-group-flush">
                            <div id="weeklyReportsContent" class="report-content">
                                {% for standup in weekly_standup_reports %}
                                <div class="list-group-item p-4" x-data="{ isOpen: false }">
                                    <!-- Team Member Header -->
                                    <div @click="isOpen = !isOpen" class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center gap-3">
                                            <div class="avatar-circle text-white">
                                                <span class="fw-semibold">{{ standup.user|first|upper }}</span>
                                            </div>
                                            <div>
                                                <h4 class="h6 mb-1">{{ standup.user }}</h4>
                                                <div class="d-flex align-items-center gap-3 small text-muted">
                                                    <span class="d-inline-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-primary" fill="currentColor" viewBox="0 0 24 24">
                                                            <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                                        </svg>
                                                        BERT: {{ standup.bert_sentiment_display }}
                                                    </span>
                                                    {% if standup.has_blockers %}
                                                    <span class="badge bg-danger-subtle text-danger">
                                                        Blocked
                                                    </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end" style="min-width: 120px;">
                                            <div class="small text-muted">{% timezone "Asia/Singapore" %}{{ standup.timestamp|date:"M j, g:i A" }}{% endtimezone %}</div>
                                        </div>
                                    </div>

                                    <!-- Expandable Content -->
                                    <div x-show="isOpen" class="mt-3">
                                        <div class="row g-3">
                                            <!-- Yesterday's Work -->
                                            <div class="col-12 col-md-6">
                                                <div class="bg-light rounded p-3 h-100">
                                                    <h5 class="mb-2 d-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                        </svg>
                                                        Yesterday's Accomplishments
                                                    </h5>
                                                    <p class="mb-0">{{ standup.yesterday|default:"No updates provided" }}</p>
                                                </div>
                                            </div>

                                            <!-- Today's Plans -->
                                            <div class="col-12 col-md-6">
                                                <div class="rounded p-3 h-100 content-section-blue">
                                                    <h5 class="mb-2 d-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                        </svg>
                                                        Today's Goals
                                                    </h5>
                                                    <p class="mb-0">{{ standup.today|default:"No goals specified" }}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Blockers & Concerns -->
                                        {% if standup.blockers %}
                                        <div class="mt-3 p-3 rounded border-start border-4 blocker-section">
                                            <h5 class="mb-2 d-flex align-items-center">
                                                <svg width="16" height="16" class="me-2 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                                    </svg>
                                                    Blockers & Concerns
                                                </h5>
                                                <p class="mb-0">{{ standup.blockers }}</p>
                                            </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% empty %}
                                <div class="empty-state">
                                    <svg class="empty-state-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <h3 class="h6 mt-2">No standup reports</h3>
                                    <p class="text-muted">No standup reports have been submitted yet.</p>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                </div>

                <!-- All Time Reports Tab -->
                <div class="tab-pane fade" id="all-time-reports" role="tabpanel" aria-labelledby="all-time-reports-tab">
                    <div class="card-scrollable">
                        <div class="tab-content-header">
                            <div class="d-flex align-items-center justify-content-between">
                                <h4 class="h6 mb-0 text-primary">
                                    <i class="fas fa-calendar-alt me-2"></i>All Time Reports
                                </h4>
                            <small class="text-muted">Complete History</small>
                            </div>
                        </div>
                        <div class="list-group list-group-flush">
                            <div class="report-content">
                                {% for standup in all_time_standup_reports %}
                                <div class="list-group-item p-4" x-data="{ isOpen: false }">
                                    <!-- Team Member Header -->
                                    <div @click="isOpen = !isOpen" class="d-flex align-items-center justify-content-between">
                                        <div class="d-flex align-items-center gap-3">
                                            <div class="avatar-circle text-white">
                                                <span class="fw-semibold">{{ standup.user|first|upper }}</span>
                                            </div>
                                            <div>
                                                <h4 class="h6 mb-0">{{ standup.user }}</h4>
                                                <div class="d-flex align-items-center gap-3 small text-muted">
                                                    <span class="d-inline-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-primary" fill="currentColor" viewBox="0 0 24 24">
                                                            <path d="M9.663 17h4.673M12 3v1m6.364 1.636l-.707.707M21 12h-1M4 12H3m3.343-5.657l-.707-.707m2.828 9.9a5 5 0 117.072 0l-.548.547A3.374 3.374 0 0014 18.469V19a2 2 0 11-4 0v-.531c0-.895-.356-1.754-.988-2.386l-.548-.547z"/>
                                                        </svg>
                                                        BERT: {{ standup.bert_sentiment_display }}
                                                    </span>
                                                    {% if standup.has_blockers %}
                                                    <span class="badge bg-danger-subtle text-danger">
                                                        Blocked
                                                    </span>
                                                    {% endif %}
                                                </div>
                                            </div>
                                        </div>
                                        <div class="text-end" style="min-width: 120px;">
                                            <div class="small text-muted">{% timezone "Asia/Singapore" %}{{ standup.timestamp|date:"M j, g:i A" }}{% endtimezone %}</div>
                                        </div>
                                    </div>

                                    <!-- Expandable Content -->
                                    <div x-show="isOpen" class="mt-3">
                                        <div class="row g-3">
                                            <!-- Yesterday's Work -->
                                            <div class="col-12 col-md-6">
                                                <div class="bg-light rounded p-3 h-100">
                                                    <h5 class="mb-2 d-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                        </svg>
                                                        Yesterday's Accomplishments
                                                    </h5>
                                                    <p class="mb-0">{{ standup.yesterday|default:"No updates provided" }}</p>
                                                </div>
                                            </div>

                                            <!-- Today's Plans -->
                                            <div class="col-12 col-md-6">
                                                <div class="rounded p-3 h-100 content-section-blue">
                                                    <h5 class="mb-2 d-flex align-items-center">
                                                        <svg width="16" height="16" class="me-2 text-primary" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                        </svg>
                                                        Today's Goals
                                                    </h5>
                                                    <p class="mb-0">{{ standup.today|default:"No goals specified" }}</p>
                                                </div>
                                            </div>
                                        </div>

                                        <!-- Blockers & Concerns -->
                                        {% if standup.blockers %}
                                        <div class="mt-3 p-3 rounded border-start border-4 blocker-section">
                                            <h5 class="mb-2 d-flex align-items-center">
                                                <svg width="16" height="16" class="me-2 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                            </svg>
                                            Blockers & Concerns
                                        </h5>
                                        <p class="mb-0">{{ standup.blockers }}</p>
                                        </div>
                                        {% endif %}
                                    </div>
                                </div>
                                {% empty %}
                                <div class="empty-state">
                                    <svg class="empty-state-icon" width="16" height="16" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
                                    </svg>
                                    <h3 class="h6 mt-2">No standup reports</h3>
                                    <p class="text-muted">No standup reports have been submitted yet.</p>
                                </div>
                                {% endfor %}
                    </div>
                </div>
            </div>
        </div>

        <!-- Blockers Section -->
                <div id="blockersSection" class="tab-pane fade">
            <!-- Blocker Sub-tabs -->
                    <div class="card-body border-bottom">
                    <ul class="nav nav-tabs" id="blockerTabs" role="tablist">
                        <li class="nav-item" role="presentation">
                            <button class="nav-link active" id="active-blockers-tab" data-bs-toggle="tab" data-bs-target="#active-blockers" type="button" role="tab" aria-controls="active-blockers" aria-selected="true">
                                <i class="fas fa-exclamation-triangle me-2"></i>Active
                            </button>
                        </li>
                        <li class="nav-item" role="presentation">
                            <button class="nav-link" id="resolved-blockers-tab" data-bs-toggle="tab" data-bs-target="#resolved-blockers" type="button" role="tab" aria-controls="resolved-blockers" aria-selected="false">
                                <i class="fas fa-check-circle me-2"></i>Resolved
                            </button>
                        </li>
                    </ul>
            </div>

                    <!-- Blockers Tab Content -->
                    <div id="blockersTabContent" class="tab-content">
                <!-- Active Blockers Tab -->
                <div class="tab-pane fade show active" id="active-blockers" role="tabpanel" aria-labelledby="active-blockers-tab">
                            <div class="card-scrollable">
                                                            <div class="tab-content-header">
                                <div class="d-flex align-items-center justify-content-between">
                                    <h4 class="h6 mb-0 text-danger">
                                        <i class="fas fa-exclamation-triangle me-2"></i>Active Blockers
                                    </h4>
                                </div>
                        </div>
                        <div class="list-group list-group-flush" id="activeBlockersContainer">
                            {% if active_blockers_list %}
                                {% for blocker in active_blockers_list %}
                                    <div class="list-group-item p-4" x-data="{ isOpen: false }">
                                        <!-- Team Member Header -->
                                        <div @click="isOpen = !isOpen" class="d-flex align-items-center justify-content-between">
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="avatar-circle text-white">
                                                    <span class="fw-semibold">{{ blocker.standup_session.user.first_name|first|upper|default:blocker.standup_session.user.username|first|upper }}</span>
                                                </div>
                                                <div>
                                                    <h4 class="h6 mb-1">{{ blocker.standup_session.user.get_full_name|default:blocker.standup_session.user.username }}</h4>
                                                    <div class="d-flex align-items-center gap-3 small text-muted">
                                                        <span class="d-inline-flex align-items-center">
                                                            <svg width="16" height="16" class="me-2 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                                            </svg>
                                                            {{ blocker.title }}
                                                        </span>
                                                        <span class="badge bg-danger-subtle text-danger">
                                                            Active Blocker
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center gap-2">
                                                <div class="text-end" style="min-width: 120px;">
                                                    <div class="small text-muted">{{ blocker.standup_session.date|date:"M j, Y" }}</div>
                                                </div>
                                                <button class="btn btn-sm btn-success" data-blocker-id="{{ blocker.id }}" data-blocker-title="{{ blocker.title|escapejs }}" onclick="event.stopPropagation(); openResolveModalFromEl(this)">
                                                    <i class="fas fa-check me-1"></i>Resolve
                                                </button>
                                            </div>
                                        </div>

                                        <!-- Expandable Content -->
                                        <div x-show="isOpen" class="mt-3">
                                            <div class="bg-light rounded p-3">
                                                <h5 class="mb-2 d-flex align-items-center">
                                                    <svg width="16" height="16" class="me-2 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                                    </svg>
                                                    Blocker Details
                                                </h5>
                                                <p class="mb-0">{{ blocker.description|default:"No additional details provided" }}</p>
                                            </div>
                                        </div>
                                    </div>
                                {% endfor %}
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                                    <p class="text-muted">No active blockers! Great job team! 🎉</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <!-- Resolved Blockers Tab -->
                <div class="tab-pane fade" id="resolved-blockers" role="tabpanel" aria-labelledby="resolved-blockers-tab">
                            <div class="card-scrollable">
                                                            <div class="tab-content-header">
                                <div class="d-flex align-items-center justify-content-between">
                                    <h4 class="h6 mb-0 text-success">
                                        <i class="fas fa-check-circle me-2"></i>Resolved Blockers
                                    </h4>
                                </div>
                        </div>
                        <div class="list-group list-group-flush" id="resolvedBlockersContainer">
                            {% if blockers %}
                                {% for blocker in blockers %}
                                    {% if blocker.status == 'resolved' %}
                                            <div class="list-group-item p-4" x-data="{ isOpen: false }">
                                        <!-- Team Member Header -->
                                        <div @click="isOpen = !isOpen" class="d-flex align-items-center justify-content-between">
                                            <div class="d-flex align-items-center gap-3">
                                                <div class="avatar-circle text-white">
                                                    <span class="fw-semibold">{{ blocker.standup_session.user.first_name|first|upper|default:blocker.standup_session.user.username|first|upper }}</span>
                                                </div>
                                                <div>
                                                    <h4 class="h6 mb-1">{{ blocker.standup_session.user.get_full_name|default:blocker.standup_session.user.username }}</h4>
                                                    <div class="d-flex align-items-center gap-3 small text-muted">
                                                        <span class="d-inline-flex align-items-center">
                                                            <svg width="16" height="16" class="me-2 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                            </svg>
                                                            {{ blocker.title }}
                                                        </span>
                                                                <span class="badge bg-success-subtle text-success">
                                                            Resolved
                                                        </span>
                                                    </div>
                                                </div>
                                            </div>
                                                    <div class="d-flex align-items-center gap-2">
                                            <div class="text-end" style="min-width: 120px;">
                                                            <div class="small text-muted">{{ blocker.resolved_date|date:"M j, Y"|default:blocker.standup_session.date|date:"M j, Y" }}</div>
                                                        </div>
                                                        <button class="btn btn-sm btn-warning unresolve-blocker-btn" data-blocker-id="{{ blocker.id }}" data-blocker-title="{{ blocker.title }}">
                                                            <i class="fas fa-undo me-1"></i>Reopen
                                                        </button>
                                            </div>
                                        </div>

                                        <!-- Expandable Content -->
                                        <div x-show="isOpen" class="mt-3">
                                            <div class="row g-3">
                                                        <!-- Original Issue -->
                                                <div class="col-12 col-md-6">
                                                    <div class="bg-white rounded p-3 h-100">
                                                        <h5 class="mb-2 d-flex align-items-center">
                                                            <svg width="16" height="16" class="me-2 text-danger" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.964-.833-2.732 0L4.082 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
                                                            </svg>
                                                            Original Issue
                                                        </h5>
                                                        <p class="mb-0">{{ blocker.description|default:"No additional details provided" }}</p>
                                                    </div>
                                                </div>

                                                <!-- Resolution -->
                                                {% if blocker.resolution_notes %}
                                                <div class="col-12 col-md-6">
                                                    <div class="rounded p-3 h-100 content-section-green">
                                                        <h5 class="mb-2 d-flex align-items-center">
                                                            <svg width="16" height="16" class="me-2 text-success" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                                            </svg>
                                                            Resolution
                                                        </h5>
                                                        <p class="mb-0">{{ blocker.resolution_notes }}</p>
                                                    </div>
                                                </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                            {% else %}
                                <div class="text-center py-4">
                                    <i class="fas fa-history fa-2x text-muted mb-2"></i>
                                    <p class="text-muted">No resolved blockers yet.</p>
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                    </div>
                </div>
            </div>
        </div>




    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- Resolve Blocker Modal -->
<div class="modal fade" id="resolveBlockerModal" tabindex="-1" aria-labelledby="resolveBlockerModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="resolveBlockerModalLabel">Resolve Blocker</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p class="mb-3">Are you sure you want to resolve <strong id="blockerTitleDisplay"></strong>?</p>
                <div class="mb-3">
                    <label for="resolutionNotes" class="form-label">Resolution Notes (Optional)</label>
                    <textarea class="form-control" id="resolutionNotes" rows="3" placeholder="Describe how this blocker was resolved..."></textarea>
                    <div class="form-text">These notes will help the team understand how similar blockers can be resolved in the future.</div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="button" class="btn btn-success" id="confirmResolveBtn">
                    <i class="fas fa-check me-1"></i>Resolve Blocker
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}
